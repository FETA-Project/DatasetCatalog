import{p as T,m as j,v as $,r as f,b as k,e as S,f as s,w as h,u as o,q as A,h as r,i as n,o as V,t as B,s as I,d as M,_ as N}from"./entry.ef179a0b.js";import{a as _,_ as U}from"./menu.f2730974.js";const F=r("h1",null," Requests ",-1),O={class:"flex flex-wrap gap-2 align-items-center justify-content-between"},H={class:"p-input-icon-left"},L=r("i",{class:"pi pi-search"},null,-1),P=["href"],K={__name:"requests",setup(z){const i=T(),g=j(),y=$(),a=f([]),b=M(()=>N(()=>import("./upload.6a89f428.js"),["./upload.6a89f428.js","./entry.ef179a0b.js","./entry.076fc270.css","./menu.f2730974.js","./upload.50fa89cb.css"],import.meta.url)),p=f({global:{value:null,matchMode:I.CONTAINS}}),v=f([]),d=()=>{_.get("/api/requests").then(t=>{v.value=t.data}).catch(t=>{i.add({severity:"error",summary:"Error while getting requests",detail:t.response.data,life:3e3})})};k(()=>d());const q=()=>{let t=[];a.value.forEach(e=>{t.push(e.title)}),console.log(t),g.require({message:`Are you sure you want to reject ${t.length} datasets?`,header:"Reject Confirmation",icon:"pi pi-exclemation-triangle",accept:()=>{a.value=null,t.forEach(e=>{_.delete(`/api/requests/${e}`).then(()=>{i.add({severity:"success",summary:"Rejection Successful",detail:`Dataset ${e} rejected.`,life:3e3}),d()}).catch(u=>{i.add({severity:"error",summary:"Error while rejecting request",detail:u.response.data,life:3e3})})})}})},D=()=>{let t=[];a.value.forEach(e=>{t.push(e.title)}),console.log(t),t.forEach(e=>{_.head(`/api/requests/${e}`).then(()=>{i.add({severity:"success",summary:"Approval Successful",detail:`Request ${e} approved.`}),d()}).catch(u=>{i.add({severity:"error",summary:"Error while accepting request",detail:"Sorry, function is not enabled at this time.",life:3e3})})})},C=()=>{y.open(b,{props:{header:"Request analysis",model:!0},onClose:t=>{const e=t.data;e&&(i.add({severity:"success",summary:"Upload Successful",detail:`File ${e} uploaded successfully.`,life:3e3}),d())}})};return(t,e)=>{const u=n("ConfirmDialog"),E=n("Toast"),m=n("Button"),R=n("InputText"),c=n("Column"),w=n("DataTable"),x=n("DynamicDialog");return V(),S("div",null,[s(U),F,s(u),s(w,{value:o(v),scrollable:"",scrollHeight:"500px",filters:o(p),selection:o(a),"onUpdate:selection":e[3]||(e[3]=l=>A(a)?a.value=l:null)},{header:h(()=>[r("div",O,[r("div",null,[s(m,{label:"Request analysis",icon:"pi pi-ticket",class:"mr-2",onClick:C}),s(m,{label:"Approve",icon:"pi pi-check",severity:"success",class:"mr-2",onClick:e[0]||(e[0]=l=>D()),disabled:!o(a)||!o(a).length},null,8,["disabled"]),s(m,{label:"Reject",icon:"pi pi-ban",severity:"danger",onClick:e[1]||(e[1]=l=>q()),disabled:!o(a)||!o(a).length},null,8,["disabled"])]),r("span",H,[L,s(R,{modelValue:o(p).global.value,"onUpdate:modelValue":e[2]||(e[2]=l=>o(p).global.value=l),placeholder:"Search..."},null,8,["modelValue"])])])]),default:h(()=>[s(E,{position:"bottom-right"}),s(c,{selectionMode:"multiple",headerStyle:"width: 3rem"}),s(c,{field:"title",header:"Title",sortable:""}),s(c,{field:"requester.name",header:"Name"}),s(c,{field:"requester.email",header:"Email"}),s(c,{header:"DOI"},{body:h(l=>[r("a",{href:"https://doi.org/"+l.data.doi,target:"_blank"},B(l.data.doi),9,P)]),_:1})]),_:1},8,["value","filters","selection"]),s(x)])}}};export{K as default};
