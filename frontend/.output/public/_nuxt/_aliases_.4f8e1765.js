import{f as J,e as V,s as oe,i as B,o as n,j as s,v as w,c as j,w as U,k as h,t as a,m as e,q as m,p,x as g,d as z,_ as K,y as ae,z as ie,r as $,A as ce,h as re,u as t,B as W,C as N}from"./entry.2517c011.js";import{a as D}from"./axios.4a70c6fc.js";import{M as de}from"./menu.ef001066.js";import{_ as G}from"./date.3f8147cb.js";const ue={key:0},_e={key:1},me=e("hr",null,null,-1),ye={class:"flex justify-content-between flex-wrap"},pe={key:0},he={key:0},fe=["onClick"],ge=["onClick"],be=["onClick"],H={__name:"comments",props:{comments:{type:[Object,Array],required:!0}},emits:["signal"],setup(R,{emit:O}){const L=J(),T=V();oe("dialogRef");const l=z(()=>K(()=>import("./create_comment.93a30544.js"),["./create_comment.93a30544.js","./entry.2517c011.js","./entry.076fc270.css","./axios.4a70c6fc.js","./create_comment.6453e953.css"],import.meta.url)),y=(d,f=!1)=>{console.log(d),L.open(l,{props:{header:f?"Edit Comment":"Add Comment",modal:!0},data:{belongs_to:d.belongs_to,comment_id:d.id,edit:f,text:f?d.text:""},onClose:()=>{k(d.belongs_to)}})},b=d=>{D.delete("/api/comments/"+d.id).then(()=>{T.add({severity:"success",summary:"Success",detail:"Comment deleted",life:3e3}),k(d.belongs_to)}).catch(f=>{T.add({severity:"error",summary:"Error",detail:f,life:3e3})})},k=d=>{O("signal",d)};return(d,f)=>{const C=H,x=B("AccordionTab"),_=B("Accordion");return n(!0),s(g,null,w(R.comments,r=>(n(),j(_,{activeIndex:0,style:{"margin-top":"0.5rem","margin-bottom":"0.5rem"}},{default:U(()=>[h(x,{header:r.deleted?"<deleted>":r.author},{default:U(()=>[r.deleted?(n(),s("span",ue,"<deleted>")):(n(),s("span",_e,a(r.text),1)),me,e("small",ye,[e("div",null,[h(G,{datetime:r.date},null,8,["datetime"]),m(),r.edited?(n(),s("span",pe," | edited ")):p("",!0)]),r.deleted?p("",!0):(n(),s("div",he,[e("span",{class:"link",onClick:A=>y(r)},"Reply",8,fe),m(" | "),e("span",{class:"link",onClick:A=>y(r,!0)},"Edit",8,ge),m(" | "),e("span",{class:"link",onClick:A=>b(r)},"Delete",8,be)]))]),h(C,{onSignal:k,comments:r.children},null,8,["comments"])]),_:2},1032,["header"])]),_:2},1024))),256)}}};const ke={style:{"list-style":"none"},class:"flex flex-column gap-1"},Ce={key:0},ve={key:0},$e={key:0,class:"pi pi-info-circle"},Re=["href"],we={key:2,class:"styled-table"},xe={key:3,style:{"white-space":"pre"}},De=["onClick"],Ue={key:1},Ae={key:0},Q={__name:"analysis",props:{acronym:{type:String,required:!0},aliases:{type:Array,required:!0},analysis:{type:Object,required:!0},files:{type:Array,required:!0}},setup(R){const O=V(),L=(y,b,k)=>(console.log(b),"/jupyter/notebooks/"+y+(b.length==0?"":".")+b.join(".")+"/"+k),T=(y,b,k)=>{D.get(`/api/analysis_files/${encodeURIComponent(y)}/${encodeURIComponent(b)}/${encodeURIComponent(k)}`).then(d=>{const f=new Blob([d.data],{type:d.headers["content-type"]}),C=window.URL.createObjectURL(f),x=document.createElement("a");x.href=C;let _="filename";const r=d.headers["content-disposition"].match(/filename="(.+)"/);r&&r[1]&&(_=r[1]),x.setAttribute("download",_),document.body.appendChild(x),x.click()}).catch(d=>{O.add({severity:"error",summary:"Error while downloading dataset",detail:d.response.data,life:3e3})})},l=y=>{if(typeof y!="string"||!y.includes("{")||!y.includes("}"))return!1;try{return JSON.parse(y),!0}catch{return!1}};return(y,b)=>{const k=Q,d=B("Fieldset"),f=ae("tooltip");return n(!0),s(g,null,w(R.analysis,(C,x)=>(n(),s(g,null,[typeof C=="object"?(n(),j(d,{key:0,legend:x.replaceAll("_"," "),toggleable:!0,style:{"margin-bottom":"1em"}},{default:U(()=>[e("ul",ke,[(n(!0),s(g,null,w(C,(_,r)=>(n(),s(g,null,[r.endsWith("_info")?p("",!0):(n(),s("li",Ce,[typeof _!="object"?(n(),s("b",ve,[C[r+"_info"]?ie((n(),s("i",$e,null,512)),[[f,C[r+"_info"],void 0,{left:!0}]]):p("",!0),m(" "+a(r.replaceAll("_"," "))+": ",1)])):p("",!0),typeof _=="string"&&_.endsWith(".ipynb")?(n(),s("a",{key:1,href:L(R.acronym,R.aliases,_),target:"_blank"},a(_),9,Re)):l(_)?(n(),s("table",we,[e("tbody",null,[(n(!0),s(g,null,w(JSON.parse(_),(A,F)=>(n(),s("tr",null,[e("td",null,a(F),1),e("td",null,a(A),1)]))),256))])])):typeof _!="object"?(n(),s("span",xe,[R.files.includes(_)?(n(),s("span",{key:0,class:"file-link",onClick:A=>T(R.acronym,R.aliases,_)},a(_),9,De)):(n(),s("span",Ue,a(_),1))])):p("",!0)]))],64))),256)),typeof C=="object"?(n(),s("span",Ae,[h(k,{analysis:C,acronym:R.acronym,aliases:R.aliases,files:R.files},null,8,["analysis","acronym","aliases","files"])])):p("",!0)])]),_:2},1032,["legend"])):p("",!0)],64))),256)}}};const Ie={class:"flex flex-column gap-3"},Ee={key:0},je=e("br",null,null,-1),Oe={class:"flex gap-2"},Le={class:"flex flex-column gap-2"},Te={key:0},Be=e("b",null,"Dataset's Parents",-1),Se=["onClick"],qe={key:1},Fe=e("b",null,"Dataset's Children",-1),Ne=["onClick"],Ve={key:2},Pe=e("b",null,"Origin Datasets",-1),Me=["onClick"],We={key:3},Je=e("b",null,"Related Datasets",-1),ze=["onClick"],Ke={key:4},Ge=e("b",null,"Datasets With the Same Origin",-1),He=["onClick"],Qe={style:{"list-style":"none"},class:"flex flex-column gap-2"},Xe={class:"flex gap-2"},Ye=e("b",null,"Acronym Aliases: ",-1),Ze=e("b",null,"Dataset Title: ",-1),et=e("b",null,"Paper Title: ",-1),tt={class:"flex gap-2"},nt=e("b",null,"Authors: ",-1),lt=e("b",null,"Date Submitted: ",-1),st=e("b",null,"Submitter: ",-1),ot=e("b",null,"Name: ",-1),at=e("b",null,"Email: ",-1),it=e("b",null,"Description: ",-1),ct=e("b",null,"Format: ",-1),rt=e("b",null,"DOI: ",-1),dt=["href"],ut=e("b",null,"Origins DOI: ",-1),_t=["href"],mt={class:"flex gap-2"},yt=e("b",null,"Tags: ",-1),pt=e("b",null,"Data URL: ",-1),ht=["href"],ft=e("b",null,"Data File: ",-1),vt={__name:"[aliases]",setup(R){const O=V(),L=$("Unknown"),T=$("Unknown"),l=$(),y=$(),b=$(),k=$(),d=$(),f=$(),C=$(),x=$(),_=ce(),r=$({}),A=$(0),F=$(null),X=J(),Y=z(()=>K(()=>import("./create_comment.93a30544.js"),["./create_comment.93a30544.js","./entry.2517c011.js","./entry.076fc270.css","./axios.4a70c6fc.js","./create_comment.6453e953.css"],import.meta.url)),S=(i,c)=>{c==""&&(c="*"),W(`/detail/${encodeURIComponent(i)}/${encodeURIComponent(c)}`)},Z=i=>{P()},P=()=>{D.get(`/api/comments/${encodeURIComponent(L.value)}`).then(i=>{r.value=i.data,A.value++}).catch(i=>{O.add({severity:"error",summary:"Error while getting comments",detail:i.response.data,life:3e3})})},ee=i=>{X.open(Y,{props:{header:"Add Comment",modal:!0},data:{belongs_to:i,parent_id:null,edit:!1,text:"",comment_id:null},onClose:()=>{P()}})},te=(i,c)=>{console.log("get"),console.log(i),console.log(c),D.all([D.get(`/api/datasets/${encodeURIComponent(i)}/${encodeURIComponent(c)}`),D.get(`/api/comments/${encodeURIComponent(i)}`)]).then(D.spread((u,q)=>{l.value=u.data.dataset,l.value.authors=l.value.authors.filter(v=>v!==""),l.value.acronym_aliases=l.value.acronym_aliases.filter(v=>v!==""),l.value.tags=l.value.tags.filter(v=>v!==""),C.value=u.data.dataset.analysis,x.value=u.data.edit_analysis_url,k.value=u.data.related_datasets,d.value=u.data.origin_datasets,f.value=u.data.same_origin_datasets,b.value=u.data.alias_children,y.value=u.data.alias_parents,r.value=q.data})).catch(u=>{O.add({severity:"error",summary:"Error while getting dataset",detail:u.response.data,life:3e3})})},ne=(i,c)=>{c==""&&(c="*"),W(`/edit/${encodeURIComponent(i)}/${encodeURIComponent(c)}`)},le=()=>{window.open(x.value,"_blank")},M=(i,c=!1)=>{let u=i;if(i)return/^https?:\/\//i.test(i)||(u=`https://${i}`),c?window.open(u,"_blank"):u;console.log("No URL - trying local file")},se=(i,c)=>{D.get(`/api/files/${encodeURIComponent(i)}/${encodeURIComponent(c)}`).then(u=>{const q=new Blob([u.data],{type:u.headers["content-type"]}),v=window.URL.createObjectURL(q),I=document.createElement("a");I.href=v;let o="filename";const E=u.headers["content-disposition"].match(/filename="(.+)"/);E&&E[1]&&(o=E[1]),I.setAttribute("download",o),document.body.appendChild(I),I.click()}).catch(u=>{O.add({severity:"error",summary:"Error while downloading dataset",detail:u.response.data,life:3e3})})};return re(()=>{L.value=decodeURIComponent(_.params.acronym),T.value=decodeURIComponent(_.params.aliases),te(L.value,T.value),D.get("/api/users/me").then(i=>{console.log(i.data),F.value=i.data}).catch()}),(i,c)=>{const u=B("Toast"),q=B("Badge"),v=B("Button"),I=B("Fieldset");return n(),s("div",Ie,[h(u,{position:"bottom-right"}),h(de),e("h1",null,[m(" Details of "+a(t(l).acronym+(t(l).acronym_aliases.length==0?"":".")+t(l).acronym_aliases.join("."))+" ",1),t(l).status=="requested"?(n(),s("div",Ee,[h(q,{value:"Requested",severity:"info"}),je])):p("",!0)]),e("h2",Oe,[t(l).filename?(n(),j(v,{key:0,onClick:c[0]||(c[0]=o=>se(t(l).acronym,t(l).acronym_aliases)),label:"Download",icon:"pi pi-download",severity:"success"})):p("",!0),t(l).url?(n(),j(v,{key:1,onClick:c[1]||(c[1]=o=>M(t(l).url,!0)),label:"Open URL",icon:"pi pi-link",severity:"success"})):p("",!0),h(v,{onClick:c[2]||(c[2]=o=>ne(t(l).acronym,t(l).acronym_aliases)),label:"Edit Info",icon:"pi pi-pencil"}),h(v,{onClick:c[3]||(c[3]=o=>le(t(l).acronym)),label:"Edit Analysis",icon:"pi pi-external-link",severity:"secondary"})]),h(I,{legend:"Related Datasets",toggleable:!0,collapsed:""},{default:U(()=>[e("ul",Le,[t(y).length>0?(n(),s("div",Te,[Be,(n(!0),s(g,null,w(t(y),o=>(n(),s("li",null,[e("span",{class:"detail-link",onClick:E=>S(o.acronym,o.aliases)},a(o.acronym+"["+o.aliases+"]"),9,Se)]))),256))])):p("",!0),t(b).length>0?(n(),s("div",qe,[Fe,(n(!0),s(g,null,w(t(b),o=>(n(),s("li",null,[e("span",{class:"detail-link",onClick:E=>S(o.acronym,o.aliases)},a(o.acronym+"["+o.aliases+"]"),9,Ne)]))),256))])):p("",!0),t(d).length>0?(n(),s("div",Ve,[Pe,(n(!0),s(g,null,w(t(d),o=>(n(),s("li",null,[e("span",{class:"detail-link",onClick:E=>S(o.acronym,o.aliases)},a(o.acronym+"["+o.aliases+"]"),9,Me)]))),256))])):p("",!0),t(k).length>0?(n(),s("div",We,[Je,(n(!0),s(g,null,w(t(k),o=>(n(),s("li",null,[e("span",{class:"detail-link",onClick:E=>S(o.acronym,o.aliases)},a(o.acronym+"["+o.aliases+"]"),9,ze)]))),256))])):p("",!0),t(f).length>0?(n(),s("div",Ke,[Ge,(n(!0),s(g,null,w(t(f),o=>(n(),s("li",null,[e("span",{class:"detail-link",onClick:E=>S(o.acronym,o.aliases)},a(o.acronym+"["+o.aliases+"]"),9,He)]))),256))])):p("",!0)])]),_:1}),h(I,{legend:"Details",toggleable:!0},{default:U(()=>[e("ul",Qe,[e("li",Xe,[Ye,(n(!0),s(g,null,w(t(l).acronym_aliases,o=>(n(),j(t(N),null,{default:U(()=>[m(a(o),1)]),_:2},1024))),256))]),e("li",null,[Ze,m(" "+a(t(l).title),1)]),e("li",null,[et,m(" "+a(t(l).paper_title),1)]),e("li",tt,[nt,(n(!0),s(g,null,w(t(l).authors,o=>(n(),j(t(N),null,{default:U(()=>[m(a(o),1)]),_:2},1024))),256))]),e("li",null,[lt,m(),h(G,{datetime:t(l).date_submitted},null,8,["datetime"])]),e("li",null,[st,e("ul",null,[e("li",null,[ot,m(" "+a(t(l).submitter.name),1)]),e("li",null,[at,m(" "+a(t(l).submitter.email),1)])])]),e("li",null,[it,m(" "+a(t(l).description),1)]),e("li",null,[ct,m(" "+a(t(l).format),1)]),e("li",null,[rt,m(),e("a",{href:t(l).doi,target:"_blank"},a(t(l).doi),9,dt)]),e("li",null,[ut,m(),e("a",{href:t(l).origins_doi,target:"_blank"},a(t(l).origins_doi),9,_t)]),e("li",mt,[yt,(n(!0),s(g,null,w(t(l).tags,o=>(n(),j(t(N),null,{default:U(()=>[m(a(o),1)]),_:2},1024))),256))]),e("li",null,[pt,m(),e("a",{href:M(t(l).url),about:"_blank"},a(t(l).url),9,ht)]),e("li",null,[ft,m(" "+a(t(l).filename),1)])])]),_:1}),h(I,{legend:"Discussion",toggleable:!0,collapsed:""},{default:U(()=>[h(v,{label:"Add Comment",icon:"pi pi-plus",severity:"secondary",onClick:c[4]||(c[4]=o=>ee(t(l).acronym)),style:{"margin-bottom":"0.3em"}}),(n(),j(H,{onSignal:Z,comments:t(r),key:t(A)},null,8,["comments"]))]),_:1}),h(Q,{analysis:t(C).analysis,acronym:t(l).acronym,aliases:t(l).acronym_aliases,files:t(l).files},null,8,["analysis","acronym","aliases","files"])])}}};export{vt as default};
